<h1>{{serie.name}}</h1>
<p ng-if="serie.ranking && serie.classes.length > 1">
  <a href="../ergebnisse/jahreswertung.shtml?serie={{serie.serie}}" target="jahreswertung:{{serie.serie}}">Auswertung</a>
</p>
<form name="form" ng-keydown="keydown($event)">
  <fieldset style="display:inline">
    <legend>Allgemein</legend>
    <table>
      <tr>
	<th align="right"><label for="name">Bezeichnung</label></th>
	<td><input type="text" size="40" maxlength="40" ng-model="serie.name" id="name"></td>
      </tr>
      <tr>
	<th align="right"><label for="abbreviation">Kürzel</label></th>
	<td><input type="text" size="10" maxlength="10" ng-model="serie.abbreviation" id="abbreviation"></td>
      </tr>
      <tr>
	<th align="right"><label for="ranking">Wertung</label></th>
	<td>
	  <select ng-model="serie.ranking" ng-options="ranking for ranking in [1,2,3,4]">
	    <option value=""></option>
	  </select>
	</td>
      </tr>
      <tr>
	<th align="right"></th>
	<td><input type="checkbox" ng-model="serie.closed" id="closed"> <label for="closed">abgeschlossen</label>
      </tr>
    </table>
  </fieldset><br>
  <fieldset style="display:inline">
    <legend>Veranstaltungen</legend>
    <table>
      <tr ng-repeat="_ in serie.events track by $index">
	<td>
	  <select ng-model="serie.events[$index]" ng-options="event.id as event_name(event) for event in events | filter:event_visible">
	    <option value=""></option>
	  </select>
	</td>
      </tr>
    </table>
  </fieldset><br>
  <fieldset style="display:inline">
    <legend>Klassen</legend>
    <table>
      <tr>
	<th>Klasse</th>
	<th>Läufe</th>
	<th>Streich-<br>resultate</th>
      </tr>
      <tr ng-repeat="class in serie.classes">
	<td align="center">
	  <!-- FIXME: Ein normales Zahlenfeld täte es auch, nur durch das sofortige Verwerfen von Duplikaten lässt
	       sich dann z.B.  Klasse 11 nicht mehr vernünftig eintragen, sobald es Klasse 1 schon gibt.  Mit
	       einer neueren stabilen Version von AngularJS könnte ng-blur helfen.  -->
	  <select ng-model="class.class" ng-options="class for class in [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]">
	    <option value=""></option>
	  </select>
	</td>
	<td align="center"><input type="text" numeric size="2" maxlength="2" min="1" max="99" ng-model="class.events" style="text-align:center"></td>
	<td align="center"><input type="text" numeric size="2" maxlength="2" min="0" max="99" ng-model="class.drop_events" style="text-align:center"></td>
      </tr>
    </table>
  </fieldset><br>
  <fieldset style="display:inline">
    <legend>Startnummernänderungen</legend>
    <span ng-repeat="event in events | filter:in_serie">
      <fieldset style="display:inline">
	<legend>{{event_name(event)}}</legend>
	<table>
	  <tr>
	    <th align="right"></th>
	    <th ng-repeat="aenderung in serie.new_numbers[event.id] track by $index" align="center"></th>
	  </tr>
	  <tr>
	    <th align="right">Von</th>
	    <td ng-repeat="aenderung in serie.new_numbers[event.id] track by $index" align="center">
	      <input type="text" numeric size="3" maxlength="5" min="1" max="99999" ng-model="aenderung.alt" style="text-align:center">
	    </td>
	  </tr>
	  <tr>
	    <th align="right">Nach</th>
	    <td align="center" ng-repeat="aenderung in serie.new_numbers[event.id] track by $index" align="center">
	      <input type="text" numeric size="3" maxlength="5" min="1" max="99999" ng-model="aenderung.neu" style="text-align:center">
	    </td>
	  </tr>
	</table>
      </fieldset><br>
    </span>
  </fieldset><br>
  <p>
    <button type="button" ng-disabled="!(modified() && form.$valid) || busy" ng-click="save()">Speichern</button>
    <button type="button" ng-disabled="!modified() || busy" ng-click="discard()" tabindex="-1">Verwerfen</button>
    <button type="button" ng-disabled="modified() || is_new" ng-click="remove()" tabindex="-1">Löschen</button>
  </p>
</form>
