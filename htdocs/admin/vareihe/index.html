<h1>{{vareihe.bezeichnung}}</h1>
<p>
  <a href="../ergebnisse/jahreswertung.shtml?vareihe={{vareihe.vareihe}}" target="jahreswertung:{{vareihe.vareihe}}">Auswertung</a>
</p>
<form name="form" ng-keydown="keydown($event)">
  <fieldset style="display:inline">
    <legend>Allgemein</legend>
    <table>
      <tr>
	<th align="right"><label for="bezeichnung">Bezeichnung</label></th>
	<td><input type="text" size="40" maxlength="40" ng-model="vareihe.bezeichnung" id="bezeichnung"></td>
      </tr>
      <tr>
	<th align="right"><label for="kuerzel">Kürzel</label></th>
	<td><input type="text" size="10" maxlength="10" ng-model="vareihe.kuerzel" id="kuerzel"></td>
      </tr>
      <tr>
	<th align="right"><label for="wertung">Wertung</label></th>
	<td>
	  <select ng-model="vareihe.wertung" ng-options="wertung for wertung in [1,2,3,4]">
	  </select>
	</td>
      <tr>
	<th align="right"></th>
	<td><input type="checkbox" ng-model="vareihe.verborgen" id="verborgen"> <label for="verborgen">Veranstaltungen in Übersicht verbergen</label></td>
      </tr>
    </table>
  </fieldset><br>
  <fieldset style="display:inline">
    <legend>Veranstaltungen</legend>
    <table>
      <tr ng-repeat="_ in vareihe.veranstaltungen track by $index">
	<td>
	  <select ng-model="vareihe.veranstaltungen[$index]" ng-options="veranstaltung.id as veranstaltung.titel for veranstaltung in veranstaltungen">
	    <option value=""></option>
	  </select>
	</td>
      </tr>
    </table>
  </fieldset><br>
  <fieldset style="display:inline">
    <legend>Klassen</legend>
    <table>
      <tr>
	<th>Klasse</th>
	<th>Läufe</th>
	<th>Streich-<br>resultate</th>
      </tr>
      <tr ng-repeat="klasse in vareihe.klassen">
	<td align="center">
	  <!-- FIXME: Ein normales Zahlenfeld täte es auch, nur durch das sofortige Verwerfen von Duplikaten lässt
	       sich dann z.B.  Klasse 11 nicht mehr vernünftig eintragen, sobald es Klasse 1 schon gibt.  Mit
	       einer neueren stabilen Version von AngularJS könnte ng-blur helfen.  -->
	  <select ng-model="klasse.klasse" ng-options="klasse for klasse in [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]">
	    <option value=""></option>
	  </select>
	</td>
	<td align="center"><input type="number" size="2" maxlength="2" min="1" max="99" ng-model="klasse.laeufe" style="text-align:center"></td>
	<td align="center"><input type="number" size="2" maxlength="2" min="0" max="99" ng-model="klasse.streichresultate" style="text-align:center"></td>
      </tr>
    </table>
  </fieldset><br>
  <fieldset style="display:inline">
    <legend>Startnummernänderungen</legend>
    <span ng-repeat="veranstaltung in veranstaltungen | filter:in_vareihe" ng-init="aenderungen = vareihe.startnummern[veranstaltung.id]">
      <fieldset style="display:inline">
	<legend>{{veranstaltung.titel}}</legend>
	<table>
	  <tr>
	    <th align="right"></th>
	    <th ng-repeat="aenderung in aenderungen track by $index" align="center"></th>
	  </tr>
	  <tr>
	    <th align="right">Von</th>
	    <td ng-repeat="aenderung in aenderungen track by $index" align="center">
	      <input type="number" size="3" maxlength="5" min="1" max="99999" ng-model="aenderung.alt" style="text-align:center">
	    </td>
	  </tr>
	  <tr>
	    <th align="right">Nach</th>
	    <td align="center" ng-repeat="aenderung in aenderungen track by $index" align="center">
	      <input type="number" size="3" maxlength="5" min="1" max="99999" ng-model="aenderung.neu" style="text-align:center">
	    </td>
	  </tr>
	</table>
      </fieldset><br>
    </span>
  </fieldset><br>
  <p>
    <button type="button" ng-disabled="!(geaendert() && form.$valid) || busy" ng-click="speichern()">Speichern</button>
    <button type="button" ng-disabled="!geaendert() || busy" ng-click="verwerfen()" tabindex="-1">Verwerfen</button>
    <button type="button" ng-disabled="geaendert() || ist_neu" ng-click="loeschen()" tabindex="-1">Löschen</button>
  </p>
</form>
