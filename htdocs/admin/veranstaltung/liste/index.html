<style type="text/css">
  a:link,a:visited { text-decoration:none; color:black; }
  a:hover,a:active { text-decoration:underline; color:#551a8b; }
</style>

<style type="text/css" ng-bind-html="print_style()">
</style>

<h1><a href="" ng-click="einstellungen($event)">{{veranstaltung.wertungen[0].titel}}</a></h1>
<div ng-if="fold.einstellungen" class="no-print">
  <p>
    <form name="form">
      <fieldset style="display:inline">
	<legend>Anzeige einstellen</legend>
	<table>
	  <tr><th align="right">Startnummer</th>
	    <td>
	      <select ng-model="anzeige.startnummer" yes-no-null title="Fahrer ist eine Startnummer zugeordnet">
		<option value="-"></option>
		<option value="no">Nein</option>
		<option value="yes">Ja</option>
	      </select>
	    </td>
	  </tr>
	  <tr ng-if="features.nennungseingang"><th align="right">Nennungseingang</th>
	    <td>
	      <select ng-model="anzeige.nennungseingang" yes-no-null>
		<option value="-"></option>
		<option value="no">Nein</option>
		<option value="yes">Ja</option>
	      </select>
	    </td>
	  </tr>
	  <tr><th align="right">Fahrer startet</th>
	    <td>
	      <select ng-model="anzeige.start" yes-no-null>
		<option value="-"></option>
		<option value="no">Nein</option>
		<option value="yes">Ja</option>
	      </select>
		<input type="checkbox" ng-model="anzeige.unterwegs" id="unterwegs"><label for="unterwegs">Fahrer auf der Strecke</label>
	    </td>
	  </tr>
	  <tr ng-if="features.start_morgen"><th align="right">Fahrer startet morgen</th>
	    <td>
	      <select ng-model="anzeige.start_morgen" yes-no-null>
		<option value="-"></option>
		<option value="no">Nein</option>
		<option value="yes">Ja</option>
	      </select>
	    </td>
	  </tr>
	  <tr ng-repeat="wertung in [1,2,3,4]" ng-if="features['wertung' + wertung]">
	    <th align="right">{{wertungsbezeichnung(wertung)}}</th>
	    <td>
	      <select ng-model="anzeige['wertung' + wertung]" yes-no-null>
		<option value="-"></option>
		<option value="no">Nein</option>
		<option value="yes">Ja</option>
	      </select>
	    </td>
	  </tr>
	  <tr>
	    <th align="right">Startnummernbereich</th>
	    <td>
	      <input type="text" numeric size="3" maxlength="5" min="-99999" mx="99999" ng-model=anzeige.startnummer_min title="Von"> −
	      <input type="text" numeric size="3" maxlength="5" min="-99999" mx="99999" ng-model=anzeige.startnummer_max title="Bis">
	    </td>
	  </tr>
	  <tr>
	    <th align="right">Klasse (in Wertung)</th>
	    <td>
	      <span ng-repeat="klasse in anzeige.startende_klassen"><input type="checkbox" ng-model="anzeige.klassen[klasse]" id="{{'klasse' + klasse}}" title="{{veranstaltung.klassen[klasse - 1].bezeichnung}}"><label for="{{'klasse' + klasse}}" title="{{veranstaltung.klassen[klasse - 1].bezeichnung}}">{{klasse}}</label> </span>
	      <input type="checkbox" ng-model="anzeige.andere_klassen" id="andere_klassen"><label for="andere_klassen">Andere</label>
	    </td>
	  </tr>
	  <tr><th align="right">Gruppieren nach</th>
	    <td>
	      <select ng-model="anzeige.gruppierung">
		<option value="-"></option>
		<option value="club" ng-if="features.club">Club</option>
		<option value="fahrzeug" ng-if="features.fahrzeug">Fahrzeug</option>
		<option value="lbl" ng-if="features.land || features.bundesland">Land (Bundesland)</option>
		<option value="wertungsklasse">Klasse (in Wertung)</option>
		<option value="versicherung" ng-if="features.versicherung">Versicherung</option>
		<option value="wohnort" ng-if="features.wohnort">Wohnort</option>
	      </select>
	    </td>
	  </tr>
	  <tr><th align="right">Sortieren nach</th>
	    <td>
	      <select ng-model="anzeige.reihenfolge">
		<option value="geburtsdatum" ng-if="features.geburtsdatum">Geburtsdatum</option>
		<option value="name">Name</option>
		<option value="startnummer">Startnummer</option>
		<option value="startzeit" ng-if="features.startzeit">Startzeit</option>
		<option value="zielzeit" ng-if="features.zielzeit">Zielzeit</option>
	      </select>
	    </td></tr>
	  <tr><th align="right">Felder</th>
	    <td>
	      <span ng-repeat="_ in anzeige.felder track by $index">
		<select ng-model="anzeige.felder[$index]" ng-options="feld.key as feld.name for feld in feldliste">
		</select>
	      </span>
	    </td></tr>
	</table>
      </fieldset><br>
    </form>
    <form id="pdf" action="../../cgi-bin/pdf.pl" method="POST" ng-if="HAVE_WEASYPRINT">
      <fieldset style="display:inline">
	<legend>Drucken</legend>
	<table>
	  <tr><th align="right">Seitenformat</th>
	    <td>
	      <select ng-model="anzeige['page-size']">
		<option value="A4">A4 Hochformat</option>
		<option value="A4 landscape">A4 Querformat</option>
	      </select>
	    </td>
	  </tr>
	  <tr><th align="right">Ränder</th>
	    <td>
	      <input type="text" size="4" maxlength="6" ng-model="anzeige['margin-left']" title="Links" style="text-align:center">
	      <input type="text" size="4" maxlength="6" ng-model="anzeige['margin-top']" title="Oben" style="text-align:center">
	      <input type="text" size="4" maxlength="6" ng-model="anzeige['margin-right']" title="Rechts" style="text-align:center">
	      <input type="text" size="4" maxlength="6" ng-model="anzeige['margin-bottom']" title="Unten" style="text-align:center">
	    </td>
	  </tr>
	  <tr><th align="right">Schriftgröße</th>
	    <td>
	      <input type="text" numeric min="6" max="20" size="2" maxlength="2" ng-model="anzeige['font-size']" style="text-align:center"> Punkt
	    </td>
	  </tr>
	  <tr ng-if="anzeige.gruppierung != '-'"><th></th>
	    <td>
	      <input type="checkbox" ng-model="anzeige.seitenumbruch" id="seitenumbruch"><label for="seitenumbruch">Seitenumbruch zwischen den Gruppen</label>
	    </td>
	  </tr>
	  <tr><th></th>
	    <td><button type="submit" ng-click="pdf_erzeugen($event)">PDF erzeugen</button></td>
	  </tr>
	</table>
      </fieldset>
      <input type="hidden" name="filename" value="Fahrerliste {{veranstaltung.wertungen[0].titel}}.pdf">
      <input type="hidden" name="url" value="{{url}}">
      <input type="hidden" name="html" value="{{html}}">
    </form>
  </p>
</div>

<style type="text/css">
table.liste td, table.liste th {
  padding: 0 0.5em 0 0.5em
}
</style>

<p>{{gesamt}} Fahrer.</p>
<div ng-repeat="gruppe in ergebnisliste" ng-init="gruppe_index = $index" ng-class="!$first && anzeige.seitenumbruch ? 'page-break' : ''">
  <h2 ng-if="anzeige.gruppierung != '-'">{{gruppe_ueberschrift(gruppe)}}</h2>
  <table class="liste">
    <thead>
      <tr>
	<th ng-repeat="feld in felder track by $index" ng-style="feld.style" ng-bind-html="feld.bezeichnung"></th>
      </tr>
    </thead>
    <tr ng-repeat="fahrer in gruppe">
      <td ng-repeat="feld in felder track by $index" ng-style="feld.style">{{$eval(feld.ausdruck, fahrer)}}</td>
    </tr>
    <tbody ng-if="aggregat[gruppe_index]">
      <tr>
	<th ng-repeat="feld in felder track by $index" ng-style="feld.style">{{aggregat[gruppe_index][$index]}}</th>
      </tr>
    </tbody>
  </table>
</div>
