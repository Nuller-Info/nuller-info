<style type="text/css">
  a:link,a:visited { text-decoration:none; color:black; }
  a:hover,a:active { text-decoration:underline; color:#551a8b; }
</style>

<style type="text/css" ng-bind-html="print_style()">
</style>

<h1><a href="" ng-click="einstellungen($event)">{{veranstaltung.wertungen[(anzeige.wertung || 1) - 1].titel}}</a></h1>
<div ng-if="fold.einstellungen" class="no-print">
  <p>
    <form name="form" ng-model="anzeige.filter">
      <fieldset style="display:inline">
	<legend>Anzeige einstellen</legend>
	<table>
	  <tr ng-if="wertungen.length"><th align="right">Wertung</th>
	    <td>
	      <select ng-model="anzeige.wertung" ng-options="wertung.wertung as wertung.bezeichnung for wertung in wertungen">
		<option value=""></option>
	      </select>
	    </td></tr>
	  <tr ng-if="wertungen.length && anzeige.wertung !== null"><th align="right">Alle Fahrer</th>
	    <td>
	      <input type="checkbox" ng-model="anzeige.alle" id="alle"><label for="alle">Auch Fahrer ohne {{veranstaltung.wertungen[anzeige.wertung - 1].bezeichnung}} anzeigen</label>
	    </td></tr>
	  <tr><th align="right">Klassen</th>
            <td>
              <span ng-repeat="klasse in klassen">
		<input type="checkbox" ng-model="anzeige.klassen[klasse - 1]" id="klasse_{{klasse}}"><label for="klasse_{{klasse}}">{{klasse}}</label>
              </span>
            </td></tr>
	  <tr><th align="right">Felder</th>
            <td>
              <span ng-repeat="_ in anzeige.felder track by $index">
                <select ng-model="anzeige.felder[$index]" ng-options="feld.key as feld.name for feld in feldliste">
                </select>
              </span>
            </td></tr>
	  <tr><th align="right">Präsentation</th>
	    <td>
	      <select ng-model="anzeige.dauer" nullable>
		<option value="">Aus</option>
		<option value="2">Sehr langsam</option>
		<option value="1">Langsam</option>
		<option value="0">Normal</option>
		<option value="-1">Schnell</option>
		<option value="-2">Sehr schnell</option>
	      </select>
	    </td></tr>
	</table>
      </fieldset><br>
    </form>
    <form id="pdf" action="../../cgi-bin/pdf.pl" method="POST" ng-if="anzeige.dauer == null">
      <fieldset style="display:inline">
	<legend>Drucken</legend>
	<table>
	  <tr><th align="right">Seitenformat</th>
	    <td>
	      <select ng-model="anzeige['page-size']">
		<option value="A4">A4 Hochformat</option>
		<option value="A4 landscape">A4 Querformat</option>
	      </select>
	    </td>
	  </tr>
	  <tr><th align="right">Ränder</th>
	    <td>
	      <input type="text" size="4" maxlength="6" ng-model="anzeige['margin-left']" title="Links" style="text-align:center">
	      <input type="text" size="4" maxlength="6" ng-model="anzeige['margin-top']" title="Oben" style="text-align:center">
	      <input type="text" size="4" maxlength="6" ng-model="anzeige['margin-right']" title="Rechts" style="text-align:center">
	      <input type="text" size="4" maxlength="6" ng-model="anzeige['margin-bottom']" title="Unten" style="text-align:center">
	    </td>
	  </tr>
	  <tr><th align="right">Schriftgröße</th>
	    <td>
	      <input type="number" min="6" max="20" size="2" maxlength="2" ng-model="anzeige['font-size']" style="text-align:center"> Punkt
	    </td>
	  </tr>
	  <tr ng-if="anzeige.gruppierung != '-'"><th></th>
	    <td>
	      <input type="checkbox" ng-model="anzeige.seitenumbruch" id="seitenumbruch"><label for="seitenumbruch">Seitenumbruch zwischen den Klassen</label>
	    </td>
	  </tr>
	  <tr><th></th>
	    <td><button ng-if="HAVE_WEASYPRINT" type="submit" ng-click="pdf_erzeugen($event)">PDF erzeugen</button></td>
	  </tr>
	</table>
      </fieldset>
      <input type="hidden" name="filename" value="{{veranstaltung.wertungen[(anzeige.wertung || 1) - 1].titel}}.pdf">
      <input type="hidden" name="url" value="{{url}}">
      <input type="hidden" name="html" value="{{html}}">
    </form>
  </p>
</div>

<style type="text/css">
table.wertung {
  border-collapse:collapse;
}
table.wertung td, table.wertung th {
  border:1px solid #98bf21;
}
table.wertung td {
  padding: 0.1em 0.2em 0.1em 0.2em;
}
table.wertung th {
  padding: 0.2em 0.3em 0.2em 0.3em;
  font-weight:bolder;
  background-color:#A7C942;
  color:#ffffff;
}
table.wertung tr.alt td {
  background-color:#EAF2D3;
}
table.wertung tr td.runde, table.wertung tr td.verteilung {
  color:#A0A0A0;
}
table.wertung tr td.wichtig {
  color:#A11111;
}
</style>

<p>{{zusammenfassung}}</p>
<div ng-repeat="klasse in klassen" ng-if="anzeige.klassen[klasse - 1] && fahrer_in_klassen[klasse - 1]" class="klasse" ng-class="!$first && anzeige.seitenumbruch ? 'page-break' : ''">
  <h2>{{veranstaltung.klassen[klasse - 1].bezeichnung}}</h2>
  <table class="wertung">
    <thead>
      <tr>
	<th style="text-align:center" ng-bind-html="klassensymbol(klasse)"></th>
	<th ng-repeat="feld in felder track by $index" ng-style="feld.style" ng-bind-html="feld.bezeichnung"></th>
	<th style="text-align:right" ng-repeat="runde in rundenliste(klasse)"><span title="Runde {{runde}}">R{{runde}}</span></th>
	<th style="text-align:right" ng-if="spalten[klasse - 1].zusatzpunkte"><span title="Zeit- und Zusatzpunkte">ZP</span></th>
	<th style="text-align:right"><span title="Gesamtpunkte">Ges</span></th>
	<th style="text-align:right"><span title="Nuller">0S</span></th>
	<th style="text-align:right"><span title="Einser">1S</span></th>
	<th style="text-align:right"><span title="Zweier">2S</span></th>
	<th style="text-align:right"><span title="Dreier">3S</span></th>
	<th style="text-align:right" ng-if="veranstaltung.vierpunktewertung"><span title="Vierer">4S</span></th>
	<th style="text-align:right" ng-if="feature.spalte5er"><span title="Fünfer">5S</span></th>
	<th style="text-align:right" ng-if="spalten[klasse - 1].stechen"><span title="Stechen">ST</span></th>
	<th style="text-align:right" ng-if="spalten[klasse - 1].wertungspunkte"><span title="Wertungspunkte {{veranstaltung.wertungen[anzeige.wertung - 1].bezeichnung}}">WP</span></th>
      </tr>
    </thead>
      <!-- Spaltenbreiten? -->
      <!-- Druckbarkeit? Kontrollierter Seitenumbruch zwischen Klassen? -->
    <tr ng-repeat="fahrer in fahrer_in_klassen[klasse - 1]" class="fahrer" ng-class-even="'alt'">
      <td style="text-align:right">{{fahrer.ausfall || fahrer.ausser_konkurrenz ? '' : (anzeige.alle ? fahrer.rang : fahrer.wertungen[anzeige.wertung - 1].rang) + '.'}}</td>
      <td ng-repeat="feld in felder track by $index" ng-style="feld.style">{{$eval(feld.ausdruck, fahrer)}}</td>
      <td style="text-align:right" ng-repeat="runde in rundenliste(klasse)" class="runde {{fahrer.runde_klasse[runde - 1]}}" ng-bind-html="fahrer.einzelpunkte[runde - 1]"></td>
      <td style="text-align:right" ng-if="spalten[klasse - 1].zusatzpunkte">{{fahrer.zusatzpunkte || ''}}</td>
      <td style="text-align:center" ng-if="fahrer.ausfall" colspan="{{5 + spalten[klasse - 1].stechen + veranstaltung.vierpunktewertung + feature.spalte5er}}">{{ausfall(fahrer)}}</td>
      <td style="text-align:right" ng-if="!fahrer.ausfall">{{fahrer.punkte}}</td>
      <td style="text-align:right" ng-if="!fahrer.ausfall" class="verteilung {{fahrer.verteilung_klasse[0]}}">{{fahrer.punkteverteilung[0]}}</td>
      <td style="text-align:right" ng-if="!fahrer.ausfall" class="verteilung {{fahrer.verteilung_klasse[1]}}">{{fahrer.punkteverteilung[1]}}</td>
      <td style="text-align:right" ng-if="!fahrer.ausfall" class="verteilung {{fahrer.verteilung_klasse[2]}}">{{fahrer.punkteverteilung[2]}}</td>
      <td style="text-align:right" ng-if="!fahrer.ausfall" class="verteilung {{fahrer.verteilung_klasse[3]}}">{{fahrer.punkteverteilung[3]}}</td>
      <td style="text-align:right" ng-if="!fahrer.ausfall && veranstaltung.vierpunktewertung" class="verteilung {{fahrer.verteilung_klasse[4]}}">{{fahrer.punkteverteilung[4]}}</td>
      <td style="text-align:right" ng-if="!fahrer.ausfall && feature.spalte5er" class="verteilung {{fahrer.verteilung_klasse[5]}}">{{fahrer.punkteverteilung[5]}}</td>
      <td style="text-align:right" ng-if="!fahrer.ausfall && spalten[klasse - 1].stechen">{{fahrer.stechen ? fahrer.stechen + '.' : ''}}</td>
      <td style="text-align:right" ng-if="spalten[klasse - 1].wertungspunkte">{{fahrer.wertungen[anzeige.wertung - 1].punkte}}</td>
    </tr>
    </tr>
  </table>
</div>
<p ng-if="veranstaltung.mtime">Letzte Änderung: {{veranstaltung.mtime}}</p>  <!-- Nur am selben Tag anzeigen -->
