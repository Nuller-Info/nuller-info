<style type="text/css">
  a:link,a:visited { text-decoration:none; color:black; }
  a:hover,a:active { text-decoration:underline; color:#551a8b; }
</style>

<style type="text/css" ng-bind-html="print_style()">
</style>

<h1 ng-if="!config.admin">{{event.title}}</h1>
<h1 ng-if="config.admin"><a href="" ng-click="settings($event)">{{event.title}}</a></h1>
<div ng-if="fold.settings" class="no-print">
  <p>
    <form name="form" ng-model="show.filter">
      <fieldset style="display:inline">
	<legend>Anzeige einstellen</legend>
	<table>
	  <tr><th>Subtitel</th>
	  <td>
	    <input type="text" size="40" maxlength="70" ng-model="show.subtitle" id="subtitle" nullable>
	  </td>
	  </tr>
	  <tr ng-if="riders_groups"><th>Fahrer/Gruppen</th>
	    <td>
	      <select ng-model="show.riders_groups">
		<option value=""></option>
		<option value="rider">Fahrer</option>
		<option value="groups">Gruppen</option>
	      </select>
	    </td></tr>
	  <tr><th>Klassen</th>
            <td>
              <span ng-repeat="tag in classes">
		<input type="checkbox" ng-model="show.classes[tag]" id="class_{{tag}}"><label for="class_{{tag}}">{{tag}}</label>
              </span>
            </td></tr>
	  <tr><th>Felder</th>
            <td>
              <span ng-repeat="_ in show.fields track by $index">
                <select ng-model="show.fields[$index]" ng-options="field.key as field.name for field in field_list">
                </select>
              </span>
            </td></tr>
	  <tr><th>Präsentation</th>
	    <td>
	      <select ng-model="show.duration" nullable numeric>
		<option value="">Aus</option>
		<option value="-2">Sehr schnell</option>
		<option value="-1">Schnell</option>
		<option value="0">Normal</option>
		<option value="1">Langsam</option>
		<option value="2">Sehr langsam</option>
	      </select>
	    </td></tr>
	</table>
      </fieldset><br>
    </form>
    <form id="pdf" action="/api/to-pdf" method="POST" ng-if="config.weasyprint && show.duration == null">
      <fieldset style="display:inline">
	<legend>Drucken</legend>
	<table>
	  <tr><th>Seitenformat</th>
	    <td>
	      <select ng-model="show['page-size']">
		<option value="A4">A4 Hochformat</option>
		<option value="A4 landscape">A4 Querformat</option>
	      </select>
	    </td>
	  </tr>
	  <tr><th>Ränder</th>
	    <td>
	      <input type="text" size="4" maxlength="6" ng-model="show['margin-left']" title="Links" style="text-align:center">
	      <input type="text" size="4" maxlength="6" ng-model="show['margin-top']" title="Oben" style="text-align:center">
	      <input type="text" size="4" maxlength="6" ng-model="show['margin-right']" title="Rechts" style="text-align:center">
	      <input type="text" size="4" maxlength="6" ng-model="show['margin-bottom']" title="Unten" style="text-align:center">
	    </td>
	  </tr>
	  <tr><th>Schriftgröße</th>
	    <td>
	      <input type="text" numeric min="6" max="20" size="2" maxlength="2" ng-model="show['font-size']" style="text-align:center"> Punkt
	    </td>
	  </tr>
	  <tr><th></th>
	    <td>
	      <input type="checkbox" ng-model="show['page-break']" id="page-break"><label for="page-break">Seitenumbruch zwischen den Klassen</label>
	    </td>
	  </tr>
	  <tr><th></th>
	    <td><button type="submit" ng-click="create_pdf($event)">PDF</button></td>
	  </tr>
	</table>
      </fieldset>
      <input type="hidden" name="filename" value="{{event.title}}.pdf">
      <input type="hidden" name="url" value="{{url}}">
      <input type="hidden" name="html" value="{{html}}">
    </form>
  </p>
</div>
<h2>{{show.subtitle}}</h2>

<style type="text/css">
table.ranking {
  border-collapse:collapse;
}
table.ranking td, table.ranking th {
  border:1px solid #98bf21;
}
table.ranking td {
  padding: 0.1em 0.2em 0.1em 0.2em;
}
table.ranking th {
  padding: 0.2em 0.3em 0.2em 0.3em;
  font-weight:bolder;
  background-color:#A7C942;
  color:#ffffff;
}
table.ranking tbody.alt {
  background-color:#EAF2D3;
}
table.ranking tr td.individual-marks, table.ranking tr td.distribution {
  color:#A0A0A0;
}
</style>
<style type="text/css" ng-if="!features.individual_marks">
table.ranking tr td.round {
  color:#A0A0A0;
}
table.ranking tr td.important {
  color:#A11111;
}
</style>

<p ng-if="show.duration == null">{{summary}}</p>

<div ng-repeat="ranking in rankings">
  <div ng-repeat="class_ranking in ranking.classes" ng-init="rounds = class_ranking.rounds; rows_per_rider = features.individual_marks ? rounds : 1" ng-class="!$first && show['page-break'] ? 'page-break' : ''" class="class">
    <h2 ng-if="ranking.name && $first">{{ranking.name}}</h2>
    <h2 ng-if="!ranking.name">{{class_ranking.name}}</h2>
    <h3 ng-if="ranking.name">{{class_ranking.name}}</h3>
      <table class="ranking">
	<thead>
	  <tr>
	    <th style="text-align:center" ng-bind-html="class_symbol(class_ranking)" adjust-width="rank"></th>
	    <th ng-repeat="field in fields track by $index" ng-attr="field.attr" ng-style="field.style" ng-bind-html="field.heading"></th>
	    <th style="text-align:right; width:1.2em" ng-if="features.individual_marks" ng-repeat="zone in class_ranking.zones" title="Sektion {{zone}}" adjust-width="individual-marks">S{{zone}}</th>
	    <th ng-if="features.individual_marks && rounds > 1" adjust-width="marks"><span title="Runde">R</span></th>
	    <th ng-if="!features.individual_marks && rounds > 1" ng-repeat="round in enumerate(1, class_ranking.rounds)" style="text-align:right" adjust-width="marks"><span title="Runde {{round}}">R{{round}}</span></th>
	    <th style="text-align:right" ng-if="class_ranking.additional_marks" adjust-width="marks"><span title="Zusatzpunkte">AP</span></th>
	    <th style="text-align:right" ng-if="class_ranking.penalty_marks" adjust-width="marks"><span title="Zeit- und Strafpunkte">ZP</span></th>
	    <th style="text-align:right" adjust-width="total-marks"><span title="Gesamtpunkte">Ges</span></th>
	    <th style="text-align:right" ng-if="distribution[0]" adjust-width="marks-distribution"><span title="Nuller">0ₛ</span></th>
	    <th style="text-align:right" ng-if="distribution[1]" adjust-width="marks-distribution"><span title="Einser">1ₛ</span></th>
	    <th style="text-align:right" ng-if="distribution[2]" adjust-width="marks-distribution"><span title="Zweier">2ₛ</span></th>
	    <th style="text-align:right" ng-if="distribution[3]" adjust-width="marks-distribution"><span title="Dreier">3ₛ</span></th>
	    <th style="text-align:right" ng-if="distribution[4]" adjust-width="marks-distribution"><span title="Vierer">4ₛ</span></th>
	    <th style="text-align:right" ng-if="distribution[5]" adjust-width="marks-distribution"><span title="Fünfer">5ₛ</span></th>
	    <th style="text-align:right" ng-if="class_ranking.tie_break" adjust-width="tie-break"><span title="Stechen">ST</span></th>
	    <th style="text-align:right" ng-if="class_ranking.scores" adjust-width="scores"><span title="{{'Wertungspunkte' + (ranking.main_ranking ? ' in ' + ranking.main_ranking_name : '')}}">WP</span></th>
	  </tr>
	</thead>
	<tbody ng-repeat="rider in class_ranking.riders track by rider.number" class="rider" ng-class-even="'alt'">
	  <tr ng-if="rider.failure || rider.non_competing">
	    <td rowspan="{{rows_per_rider}}" style="text-align:right"></td>
	    <td rowspan="{{rows_per_rider}}" ng-repeat="field in fields track by $index" ng-style="field.style">{{$eval(field.expr, rider)}}</td>
	    <td ng-if="features.individual_marks" ng-repeat="zone in class_ranking.zones" style="text-align:right" class="individual-marks">{{rider.marks_per_zone[0][zone - 1]}}</td>
	    <td ng-if="features.individual_marks && rounds > 1" style="text-align:right" class="round {{rider.decisive_round == 1 ? 'important' : ''}}" ng-bind-html="rider.marks_in_round(1)"></td>
	    <td ng-if="!features.individual_marks && rounds > 1" ng-repeat="round in enumerate(1, class_ranking.rounds)" rowspan="{{rows_per_rider}}" style="text-align:right" class="round {{rider.decisive_round == round ? 'important' : ''}}" ng-bind-html="rider.marks_in_round(round)"></td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="class_ranking.additional_marks">{{rider.additional_marks | fractional}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="class_ranking.penalty_marks">{{rider.penalty_marks | fractional}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:center" colspan="{{1 + class_ranking.tie_break + marks_distribution_columns}}">{{failure(rider)}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="class_ranking.scores">{{rider.score | fractional}}</td>
	  </tr>
	  <tr ng-if="!(rider.failure || rider.non_competing)">
	    <td rowspan="{{rows_per_rider}}" style="text-align:right">{{rank(rider)}}</td>
	    <td rowspan="{{rows_per_rider}}" ng-repeat="field in fields track by $index" ng-style="field.style">{{$eval(field.expr, rider)}}</td>
	    <td ng-if="features.individual_marks" ng-repeat="zone in class_ranking.zones" style="text-align:right" class="individual-marks">{{rider.marks_per_zone[0][zone - 1]}}</th>
	    <td ng-if="features.individual_marks && rounds > 1" style="text-align:right" class="round {{rider.decisive_round == 1 ? 'important' : ''}}" ng-bind-html="rider.marks_in_round(1)"></td>
	    <td ng-if="!features.individual_marks && rounds > 1" ng-repeat="round in enumerate(1, class_ranking.rounds)" rowspan="{{rows_per_rider}}" style="text-align:right" class="round {{rider.decisive_round == round ? 'important' : ''}}" ng-bind-html="rider.marks_in_round(round)"></td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="class_ranking.additional_marks">{{rider.additional_marks | fractional}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="class_ranking.penalty_marks">{{rider.penalty_marks | fractional}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right">{{rider.marks | fractional}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="distribution[0]" class="distribution {{rider.decisive_marks == 0 ? 'important' : ''}}">{{rider.marks_distribution[0]}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="distribution[1]" class="distribution {{rider.decisive_marks == 1 ? 'important' : ''}}">{{rider.marks_distribution[1]}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="distribution[2]" class="distribution {{rider.decisive_marks == 2 ? 'important' : ''}}">{{rider.marks_distribution[2]}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="distribution[3]" class="distribution {{rider.decisive_marks == 3 ? 'important' : ''}}">{{rider.marks_distribution[3]}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="distribution[4]" class="distribution {{rider.decisive_marks == 4 ? 'important' : ''}}">{{rider.marks_distribution[4]}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="distribution[5]" class="distribution {{rider.decisive_marks == 5 ? 'important' : ''}}">{{rider.marks_distribution[5]}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="class_ranking.tie_break">{{rider.tie_break ? rider.tie_break + '.' : ''}}</td>
	    <td rowspan="{{rows_per_rider}}" style="text-align:right" ng-if="class_ranking.scores">{{rider.score | fractional}}</td>
	  </tr>
	  <tr ng-if="features.individual_marks" ng-repeat="round in enumerate(2, class_ranking.rounds)">
	    <td ng-repeat="zone in class_ranking.zones" style="text-align:right" class="individual-marks">{{rider.marks_per_zone[round - 1][zone - 1]}}</td>
	    <td ng-if="rounds > 1" style="text-align:right" class="round {{rider.decisive_round == round ? 'important' : ''}}" ng-bind-html="rider.marks_in_round(round)"></td>
	  </tr>
	</tbody>
      </table>
  </div>
</div>
<p ng-if="event.mtime && same_day(event.date)">Letzte Änderung: {{event.mtime}}</p>
