<style type="text/css">
  a:link,a:visited { text-decoration:none; color:black; }
  a:hover,a:active { text-decoration:underline; color:#551a8b; }
</style>

<style type="text/css" ng-bind-html="print_style()">
</style>

<h1><a href="" ng-click="settings($event)">{{event.title}}</a></h1>
<div ng-if="fold.settings" class="no-print">
  <p>
    <form name="form" ng-model="show.filter">
      <fieldset style="display:inline">
	<legend>Anzeige einstellen</legend>
	<table>
	  <tr><th>Subtitel</th>
	  <td>
	    <input type="text" size="40" maxlength="70" ng-model="show.subtitle" id="subtitle" nullable>
	  </td>
	  </tr>
	  <tr ng-if="riders_groups"><th>Fahrer/Gruppen</th>
	    <td>
	      <select ng-model="show.riders_groups">
		<option value=""></option>
		<option value="rider">Fahrer</option>
		<option value="groups">Gruppen</option>
	      </select>
	    </td></tr>
	  <tr ng-if="rankings.length"><th>Wertung</th>
	    <td>
	      <select ng-model="show.ranking" ng-options="ranking.ranking as ranking.name for ranking in rankings">
		<option value=""></option>
	      </select>
	    </td></tr>
	  <tr ng-if="rankings.length && show.ranking !== null"><th>Alle Fahrer</th>
	    <td>
	      <input type="checkbox" ng-model="show.all" id="all"><label for="all">Auch Fahrer und Gruppen ohne {{event.rankings[show.ranking - 1].name}} anzeigen</label>
	    </td></tr>
	  <tr><th>Klassen</th>
            <td>
              <span ng-repeat="class in classes | filter:is_class_of_riders">
		<input type="checkbox" ng-model="show.classes[class - 1]" id="class_{{class}}"><label for="class_{{class}}">{{event.classes[class - 1].groups ? 'Gruppen' : class}}</label>
              </span>
            </td></tr>
	  <tr><th>Felder</th>
            <td>
              <span ng-repeat="_ in show.fields track by $index">
                <select ng-model="show.fields[$index]" ng-options="field.key as field.name for field in field_list">
                </select>
              </span>
            </td></tr>
	  <tr><th>Präsentation</th>
	    <td>
	      <select ng-model="show.duration" nullable>
		<option value="">Aus</option>
		<option value="-2">Sehr schnell</option>
		<option value="-1">Schnell</option>
		<option value="0">Normal</option>
		<option value="1">Langsam</option>
		<option value="2">Sehr langsam</option>
	      </select>
	    </td></tr>
	</table>
      </fieldset><br>
    </form>
    <form id="pdf" action="/api/to-pdf" method="POST" ng-if="config.weasyprint && show.duration == null">
      <fieldset style="display:inline">
	<legend>Drucken</legend>
	<table>
	  <tr><th>Seitenformat</th>
	    <td>
	      <select ng-model="show['page-size']">
		<option value="A4">A4 Hochformat</option>
		<option value="A4 landscape">A4 Querformat</option>
	      </select>
	    </td>
	  </tr>
	  <tr><th>Ränder</th>
	    <td>
	      <input type="text" size="4" maxlength="6" ng-model="show['margin-left']" title="Links" style="text-align:center">
	      <input type="text" size="4" maxlength="6" ng-model="show['margin-top']" title="Oben" style="text-align:center">
	      <input type="text" size="4" maxlength="6" ng-model="show['margin-right']" title="Rechts" style="text-align:center">
	      <input type="text" size="4" maxlength="6" ng-model="show['margin-bottom']" title="Unten" style="text-align:center">
	    </td>
	  </tr>
	  <tr><th>Schriftgröße</th>
	    <td>
	      <input type="text" numeric min="6" max="20" size="2" maxlength="2" ng-model="show['font-size']" style="text-align:center"> Punkt
	    </td>
	  </tr>
	  <tr><th></th>
	    <td>
	      <input type="checkbox" ng-model="show['page-break']" id="page-break"><label for="page-break">Seitenumbruch zwischen den Klassen</label>
	    </td>
	  </tr>
	  <tr><th></th>
	    <td><button type="submit" ng-click="create_pdf($event)">PDF</button></td>
	  </tr>
	</table>
      </fieldset>
      <input type="hidden" name="filename" value="{{event.title}}.pdf">
      <input type="hidden" name="url" value="{{url}}">
      <input type="hidden" name="html" value="{{html}}">
    </form>
  </p>
</div>
<h2>{{show.subtitle}}</h2>

<style type="text/css">
table.ranking {
  border-collapse:collapse;
}
table.ranking td, table.ranking th {
  border:1px solid #98bf21;
}
table.ranking td {
  padding: 0.1em 0.2em 0.1em 0.2em;
}
table.ranking th {
  padding: 0.2em 0.3em 0.2em 0.3em;
  font-weight:bolder;
  background-color:#A7C942;
  color:#ffffff;
}
table.ranking tr.alt td {
  background-color:#EAF2D3;
}
table.ranking tr td.individual-marks, table.ranking tr td.distribution {
  color:#A0A0A0;
}
</style>
<style type="text/css" ng-if="!features.individual_marks">
table.ranking tr td.round {
  color:#A0A0A0;
}
table.ranking tr td.important {
  color:#A11111;
}
</style>

<p ng-if="show.duration == null">{{summary}}</p>
<div ng-if="!classes.length">
Keine Fahrer oder Gruppen.
</div>
<div ng-repeat="class in classes | filter:show_class" ng-init="rounds = event.classes[class - 1].rounds" class="class" ng-class="!$first && show['page-break'] ? 'page-break' : ''">
  <h2>{{event.classes[class - 1].name}}</h2>
  <table class="ranking">
    <thead>
      <tr>
	<th style="text-align:center" ng-bind-html="class_symbol(class)"></th>
	<th ng-repeat="field in fields track by $index" ng-style="field.style" ng-bind-html="field.heading"></th>
	<th style="display:none" ng-repeat-start="round in rounds_list(class)"></th>
	<th style="text-align:right; width:1.2em" ng-if="features.individual_marks" ng-repeat="zone in event.zones[class - 1]" title="Sektion {{zone}}">{{zone}}</th>
	<th style="text-align:right" ng-repeat-end ng-if="rounds > 1"><span title="Runde {{round}}">R{{round}}</span></th>
	<th style="text-align:right" ng-if="columns[class - 1].additional_marks"><span title="Zeit- und Zusatzpunkte">ZP</span></th>
	<th style="text-align:right"><span title="Gesamtpunkte">Ges</span></th>
	<th style="text-align:right" ng-if="distribution[0]"><span title="Nuller">0ₛ</span></th>
	<th style="text-align:right" ng-if="distribution[1]"><span title="Einser">1ₛ</span></th>
	<th style="text-align:right" ng-if="distribution[2]"><span title="Zweier">2ₛ</span></th>
	<th style="text-align:right" ng-if="distribution[3]"><span title="Dreier">3ₛ</span></th>
	<th style="text-align:right" ng-if="distribution[4]"><span title="Vierer">4ₛ</span></th>
	<th style="text-align:right" ng-if="distribution[5]"><span title="Fünfer">5ₛ</span></th>
	<th style="text-align:right" ng-if="columns[class - 1].tie_break"><span title="Stechen">ST</span></th>
	<th style="text-align:right" ng-if="columns[class - 1].score"><span title="Wertungspunkte {{event.rankings[show.ranking - 1].name}}">WP</span></th>
      </tr>
    </thead>
      <!-- Spaltenbreiten? -->
      <!-- Druckbarkeit? Kontrollierter Seitenumbruch zwischen Klassen? -->
    <tbody ng-repeat="rider in riders_in_classes[class - 1] track by rider.number" class="rider">
      <tr ng-class-even="'alt'" ng-if="rider.failure || rider.non_competing">
	<td style="text-align:right"></td>
	<td ng-repeat="field in fields track by $index" ng-style="field.style">{{$eval(field.expr, rider)}}</td>
	<td style="display:none" ng-repeat-start="round in rounds_list(class)"></td>
	<td style="text-align:right" ng-if="features.individual_marks" ng-repeat="zone in event.zones[class - 1]" class="individual-marks">{{rider.individual_marks(round, zone)}}</th>
	<td style="text-align:right" ng-repeat-end ng-if="rounds > 1" class="round {{rider.round_class[round - 1]}}" ng-bind-html="rider.marks_in_round(round)"></td>
	<td style="text-align:right" ng-if="columns[class - 1].additional_marks">{{rider.additional_marks | fractional}}</td>
	<td style="text-align:center" colspan="{{1 + columns[class - 1].tie_break + marks_distribution_columns}}">{{failure(rider)}}</td>
	<td style="text-align:right" ng-if="columns[class - 1].score">{{rider.rankings[show.ranking - 1].score | fractional}}</td>
      </tr>
      <tr ng-class-even="'alt'" ng-if="!(rider.failure || rider.non_competing)">
	<td style="text-align:right">{{rank(rider)}}</td>
	<td ng-repeat="field in fields track by $index" ng-style="field.style">{{$eval(field.expr, rider)}}</td>
	<td style="display:none" ng-repeat-start="round in rounds_list(class)"></td>
	<td style="text-align:right" ng-if="features.individual_marks" ng-repeat="zone in event.zones[class - 1]" class="individual-marks">{{rider.individual_marks(round, zone)}}</th>
	<td style="text-align:right" ng-repeat-end ng-if="rounds > 1" class="round {{rider.round_class[round - 1]}}" ng-bind-html="rider.marks_in_round(round)"></td>
	<td style="text-align:right" ng-if="columns[class - 1].additional_marks">{{rider.additional_marks | fractional}}</td>
	<td style="text-align:right">{{rider.marks | fractional}}</td>
	<td style="text-align:right" ng-if="distribution[0]" class="distribution {{rider.distribution_class[0]}}">{{rider.marks_distribution[0]}}</td>
	<td style="text-align:right" ng-if="distribution[1]" class="distribution {{rider.distribution_class[1]}}">{{rider.marks_distribution[1]}}</td>
	<td style="text-align:right" ng-if="distribution[2]" class="distribution {{rider.distribution_class[2]}}">{{rider.marks_distribution[2]}}</td>
	<td style="text-align:right" ng-if="distribution[3]" class="distribution {{rider.distribution_class[3]}}">{{rider.marks_distribution[3]}}</td>
	<td style="text-align:right" ng-if="distribution[4]" class="distribution {{rider.distribution_class[4]}}">{{rider.marks_distribution[4]}}</td>
	<td style="text-align:right" ng-if="distribution[5]" class="distribution {{rider.distribution_class[5]}}">{{rider.marks_distribution[5]}}</td>
	<td style="text-align:right" ng-if="columns[class - 1].tie_break">{{rider.tie_break ? rider.tie_break + '.' : ''}}</td>
	<td style="text-align:right" ng-if="columns[class - 1].score">{{rider.rankings[show.ranking - 1].score | fractional}}</td>
      </tr>
    </tbody>
  </table>
</div>
<p ng-if="event.mtime && same_day(event.date)">Letzte Änderung: {{event.mtime}}</p>
