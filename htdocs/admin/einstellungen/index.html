<h1>{{veranstaltung.wertungen[0].titel}} - Einstellungen</h1>
<form name="form" ng-keydown="keydown($event)">
  <fieldset style="display:inline">
    <legend>Allgemein</legend>
    <table>
      <tr ng-if="!veranstaltung.id">
	<th align="right"><label for="titel">Basierend auf</label></th>
	<td>
	  <select ng-model="veranstaltung.basis" ng-options="veranstaltung.id as veranstaltung.titel for veranstaltung in veranstaltungen | filter:sichtbar">
	    <option value=""></option>
	  </select>
	</td>
      </tr>
      <tr>
	<th align="right"><label for="titel">Titel</label></th>
	<td><input type="text" size="40" maxlength="70" ng-model="veranstaltung.wertungen[0].titel" id="titel" name="titel"></td>
      </tr>
      <tr>
	<th align="right"><label for="subtitel">Subtitel</label></th>
	<td><input type="text" size="40" maxlength="70" ng-model="veranstaltung.wertungen[0].subtitel" id="subtitel"></td>
      </tr>
      <tr>
	<th align="right"><label for="datum">Datum</label></th>
	<td><input type="text" size="10" maxlength="10" ng-model="veranstaltung.datum" iso-date id="datum"></td>
      </tr>
      <tr ng-if="!veranstaltung.id">
	<th align="right"><label for="titel">Zurücksetzen auf</label></th>
	<td>
	  <select ng-model="veranstaltung.reset">
	    <option value=""></option>
	    <option value="start">Start</option>
	    <option value="nennbeginn">Nennbeginn</option>
	    <option value="stammdaten">Nur Stammdaten</option>
	  </select>
	</td>
      </tr>
    </table>
    <p>
      <input type="checkbox" ng-model="veranstaltung.aktiv" id="aktiv"><label for="aktiv">Diese Veranstaltung wird angezeigt und in den Gesamtwertungen berücksichtigt.</label>
    </p>
  </fieldset><br>
  <fieldset style="display:inline">
    <legend>Wertungen</legend>
    <p>
      <label for="punkte_sektion_auslassen">Für das Auslassen einer Sektion gibt es <input type="number" size="2" maxlength="3" min="0" max="999" ng-model="veranstaltung.punkte_sektion_auslassen" id="punkte_sektion_auslassen"> Punkte.</label>
    </p>
    <p>
      <input type="checkbox" ng-model="veranstaltung.vierpunktewertung" id="vierpunktewertung"><label for="vierpunktewertung">Es gilt die Vierpunktewertung (Fahrradtrial).</label>
    </p>
    <p>
      <label for="wertungsmodus">Bei Gleichstand zählt das Rundenergebnis
      <select name="wertungsmodus" ng-model="veranstaltung.wertungsmodus" numeric>
	<option value="0">nicht</option>
	<option value="1">der ersten besseren Runde</option>
	<option value="2">der letzten besseren Runde</option>
      </select>.</label>
    </p>
    <span ng-repeat="wertung in veranstaltung.wertungen track by $index">
      <fieldset style="display:inline">
	<legend>Wertung {{$index + 1}}</legend>
	<table>
	  <tr>
	    <th align="right"><label for="wertung{{$index + 1}}_titel">Titel</label></th>
	    <td>
	      <input type="text" size="40" maxlength="70" ng-model="wertung.titel" id="wertung{{$index + 1}}_titel">
	    </td>
	  </tr>
	  <tr>
	    <th align="right"><label for="wertung{{$index + 1}}_subtitel">Subtitel</label></th>
	    <td>
	      <input type="text" size="40" maxlength="70" ng-model="wertung.subtitel" id="wertung{{$index + 1}}_subtitel">
	    </td>
	  </tr>
	  <tr>
	    <th align="right"><label for="wertung{{$index + 1}}_bezeichnung">Bezeichnung</label></th>
	    <td>
	      <input type="text" size="20" maxlength="20" ng-model="wertung.bezeichnung" id="wertung{{$index + 1}}_bezeichnung">
	    </td>
	  </tr>
	</table>
      </fieldset><br>
    </span>
    <fieldset style="display:inline">
      <legend>Wertungspunkte</legend>
      <table>
	<tr>
	  <th>Rang</th>
	  <th>Punkte</th>
	<tr ng-repeat="punkte in veranstaltung.wertungspunkte track by $index">
	  <th>
	    <span title="{{$last ? 'Ab dem ' : ''}}{{$index + 1}}. Platz">{{$index + 1}}{{$last ? '+' : ''}}</span>
	  </th>
	  <td>
	    <input type="number" size="2" maxlength="3" min="0" max="999" ng-model="veranstaltung.wertungspunkte[$index]">
	  </td>
	</tr>
      </table>
      <p>
	<input type="checkbox" ng-model="veranstaltung.wertungspunkte_234" id="wertungspunkte_234"><label for="wertungspunkte_234">Wertungspunkte auch in den Wertungen 2, 3, und 4 vergeben.</label>
      </p>
      <p>
	<input type="checkbox" ng-model="veranstaltung.punkteteilung" id="punkteteilung"><label for="punkteteilung">Punkteteilung bei gleicher Platzierung.</label>
      </p>
    </fieldset>
  </fieldset><br>
  <fieldset style="display:inline">
    <legend>Klassen</legend>
    <!--
    <p>
      <input type="checkbox" name="klassen_gleich" id="klassen_gleich"><label for="klassen_gleich">Alle Klassen haben die gleiche Rundenanzahl, Fahrzeit, und befahren die gleichen Sektionen.</label>
    </p>
    -->
    <table>
      <tr>
	<th>Klasse</th>
	<th>Bezeichnung</th>
	<th>Spurfarbe</th>
	<th>Runden</th>
	<th>Fahrzeit</th>
	<th>Befahrene Sektionen</th>
      </tr>
      <tr ng-repeat="klasse in veranstaltung.klassen track by $index">
	<th>{{$index + 1}}</th>
	<td align="center">
	  <input type="text" size="30" maxlengh="60" ng-model="klasse.bezeichnung">
	</td>
	<td align="center">
	  <!-- FIXME: Wenn leeres Feld eingegeben wird, wird Wert auf "" statt auf null gesetzt. -->
	  <select ng-model="klasse.farbe" id="klasse{{$index + 1}}_farbe">
	    <option value=""></option>
	    <option value="#0000ff">Blau</option>
	    <option value="#ff0000">Rot</option>
	    <option value="#ffff00">Gelb</option>
	    <option value="#ffffff">Weiss</option>
	    <option value="#008000">Grün</option>
	    <option value="#a52a2a">Braun</option>
	    <!-- Weitere HTML-Farbcodes (z.B. #f660ab für Pink) hier anhängen. -->
	  </select>
	</td>
	<td align="center">
	  <input type="number" size="1" maxlength="1" min="1" max="9" ng-model="klasse.runden">
	</td>
	<td align="center">
	  <!-- FIXME: Wenn leeres Feld eingegeben wird, wird Wert auf "" statt auf null gesetzt. -->
	  <input type="text" size="5" maxlength="5" ng-model="klasse.fahrzeit" iso-time id="klasse{{$index + 1}}_fahrzeit">
	</td>
	<td align="center">
	  <input ng-repeat="sektion in befahrene_sektionen() track by $index" type="checkbox" ng-model="sektionen[$parent.$index][$index]" title="Sektion {{sektion}}">
	</td>
      </tr>
    </table>
  </fieldset><br>
  <fieldset style="display:inline">
    <legend>Kartenfarben</legend>
    <table>
      <tr ng-repeat="runde in [1, 2, 3, 4, 5]">
	<th>Runde {{runde}}</th>
	<td>
	  <select ng-model="veranstaltung.kartenfarben[$index]">
	    <option value=""></option>
	    <option value="#0000ff">Blau</option>
	    <option value="#ff0000">Rot</option>
	    <option value="#ffff00">Gelb</option>
	    <option value="#ffffff">Weiss</option>
	    <option value="#008000">Grün</option>
	    <option value="#a52a2a">Braun</option>
	    <!-- Weitere HTML-Farbcodes (z.B. #f660ab für Pink) hier anhängen. -->
	  </select>
	</td>
      </tr>
    </table>
  </fieldset><br>
  <fieldset style="display:inline">
    <legend>Nennformular</legend>
    <fieldset style="display:inline">
      <legend>Sichtbare Felder</legend>
	<p>
	  <input type="checkbox" ng-model="features.startnummer" id="feature_startnummer" disabled="disabled"><label for="feature_startnummer">Startnummer</label><br>
	  <input type="checkbox" ng-model="features.klasse" id="feature_klasse" disabled="disabled"><label for="feature_klasse">Klasse</label><br>
	  <input type="checkbox" ng-model="features.nachname" id="feature_nachname" disabled="disabled"><label for="feature_nachname">Nachname</label><br>
	  <input type="checkbox" ng-model="features.vorname" id="feature_vorname" disabled="disabled"><label for="feature_vorname">Vorname</label><br>
	  <input type="checkbox" ng-model="features.wertung1" id="feature_wertung1"><label for="feature_wertung1">Wertung 1</label><br>
	  <input type="checkbox" ng-model="features.nennungseingang" id="feature_nennungseingang"><label for="feature_nennungseingang">Nennungseingang</label><br>
	  <input type="checkbox" ng-model="features.papierabnahme" id="feature_papierabnahme" disabled="disabled"><label for="feature_papierabnahme">Papierabnahme</label><br>
	  <input type="checkbox" ng-model="features.helfer" id="feature_helfer"><label for="feature_helfer">Helfer</label>
	</p>

	<p>
	  <input type="checkbox" ng-model="features.kennzeichen" id="feature_kennzeichen"><label for="feature_kennzeichen">Pol. Kennzeichen</label><br>
	  <input type="checkbox" ng-model="features.land" id="feature_land"><label for="feature_land">Staatsangehörigkeit</label><br>
	  <input type="checkbox" ng-model="features.rahmennummer" id="feature_rahmennummer"><label for="feature_rahmennummer">Rahmennummer</label><br>
	  <input type="checkbox" ng-model="features.lizenznummer" id="feature_lizenznummer"><label for="feature_lizenznummer">Lizenznummer</label><br>
	  <input type="checkbox" ng-model="features.hubraum" id="feature_hubraum"><label for="feature_hubraum">Hubraum</label><br>
	  <input type="checkbox" ng-model="features.bemerkung" id="feature_bemerkung"><label for="feature_bemerkung">Bemerkung</label><br>
	  <input type="checkbox" ng-model="features.strasse" id="feature_strasse"><label for="feature_strasse">Straße</label><br>
	  <input type="checkbox" ng-model="features.plz" id="feature_plz"><label for="feature_plz">Postleitzahl</label><br>
	  <input type="checkbox" ng-model="features.wohnort" id="feature_wohnort"><label for="feature_wohnort">Wohnort</label><br>
	  <input type="checkbox" ng-model="features.telefon" id="feature_telefon"><label for="feature_telefon">Telefon</label><br>
	  <input type="checkbox" ng-model="features.geburtsdatum" id="feature_geburtsdatum"><label for="feature_geburtsdatum">Geburtsdatum</label><br>
	  <input type="checkbox" ng-model="features.bewerber" id="feature_bewerber"><label for="feature_bewerber">Bewerber</label><br>
	  <input type="checkbox" ng-model="features.club" id="feature_club"><label for="feature_club">Club</label><br>
	  <input type="checkbox" ng-model="features.fahrzeug" id="feature_fahrzeug"><label for="feature_fahrzeug">Fahrzeug</label><br>
	  <input type="checkbox" ng-model="features.startzeit" id="feature_startzeit"><label for="feature_startzeit">Startzeit</label><br>
	  <input type="checkbox" ng-model="features.zielzeit" id="feature_zielzeit"><label for="feature_zielzeit">Zielzeit</label><br>
	  <input type="checkbox" ng-model="features.wertung2" id="feature_wertung2"><label for="feature_wertung2">Wertung 2</label><br>
	  <input type="checkbox" ng-model="features.wertung3" id="feature_wertung3"><label for="feature_wertung3">Wertung 3</label><br>
	  <input type="checkbox" ng-model="features.wertung4" id="feature_wertung4"><label for="feature_wertung4">Wertung 4</label><br>
	  <input type="checkbox" ng-model="features.nenngeld" id="feature_nenngeld"><label for="feature_nenngeld">Nenngeld</label><br>
	  <input type="checkbox" ng-model="features.versicherung" id="feature_versicherung"><label for="feature_versicherung">Versicherung</label>
	</p>
	<p>
	  <input type="checkbox" ng-model="features.bundesland" id="feature_bundesland"><label for="feature_bundesland">Bundesland</label><br>
	</p>
    </fieldset><br>
    <fieldset style="display:inline">
      <legend>Voreinstellungen für neue Fahrer</legend>
      <p>
	<input type="checkbox" ng-model="veranstaltung.wertung1_markiert" id="wertung1_markiert"><label for="wertung1_markiert">Der Fahrer nimmt an Wertung 1 teil.</label>
      </p>
      <p>
	<label for="versicherung">Die Versicherungsart ist
	<select ng-model="veranstaltung.versicherung" id="versicherung" numeric>
	  <option value="0"></option>
	  <option value="1">ADAC-Versicherung</option>
	  <option value="2">DMV-Versicherung</option>
	  <option value="3">KFZ-Versicherung</option>
	  <option value="4">Tagesversicherung</option>
	</select>.</label>
      </p>
    </fieldset>
  </fieldset>
  <p>
    <span style="color: red">{{fehler}}</span>
  </p>
  <p>
    <button type="button" ng-disabled="!(geaendert() && form.$valid)" ng-click="speichern()">Speichern</button>
    <button type="button" ng-disabled="!geaendert()" ng-click="verwerfen()" tabindex="-1">Verwerfen</button>
  </p>
</form>
