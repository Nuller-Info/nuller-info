<h1>{{veranstaltung.wertungen[0].titel}} – {{gruppen ? 'Gruppen' : 'Fahrer'}}</h1>
<table>
  <tr>
    <td valign="top">
      <form name="form" ng-keydown="keydown($event)">
	<fieldset style="display:inline">
	  <legend>Nennung</legend>
	  <table>
	    <tr ng-if="!gruppen && features.klasse">
	      <th align="right"><label for="klasse" accesskey="k"><span class="accesskey">K</span>lasse</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" numeric size="2" maxlength="2" min="1" max="15" ng-model="fahrer.klasse" id="klasse">
		<select ng-disabled="!enabled.fahrer" ng-model="fahrer.klasse" ng-options="klasse.klasse as klasse.klasse + ': ' + klasse.bezeichnung for klasse in definierte_klassen" tabindex="-1">
		  <option value=""></option>
		</select>
		<span ng-if="fahrer.klasse != null && fahrer.klasse != veranstaltung.klassen[fahrer.klasse - 1].wertungsklasse">
		  (Wertung in Klasse {{veranstaltung.klassen[fahrer.klasse - 1].wertungsklasse}})</br>
		</span>
	      </td>
	    </tr>
	    <tr ng-if="features.startnummer">
	      <th align="right"><label for="startnummer" accesskey="t">S<span class="accesskey">t</span>artnummer</label></th>
	      <td>
		<input ng-if="features.startnummer" ng-disabled="!enabled.startnummer" type="text" numeric size="3" maxlength="5" min="1" max="99999" ng-model="intern.startnummer" name="startnummer" id="startnummer" ui-validate="'startnummer_gueltig($value)'">
	      </td>
	    </tr>
	    <tr ng-if="features.vorname">
	      <th align="right"><label for="vorname" accesskey="v"><span class="accesskey">V</span>orname</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="30" maxlength="30" ng-model="fahrer.vorname" id="vorname">
	      </td>
	    </tr>
	    <tr ng-if="features.nachname">
	      <th align="right"><label for="nachname" accesskey="n"><span ng-if="gruppen"><span class="accesskey">N</span>ame</span><span ng-if="!gruppen"><span class="accesskey">N</span>achname</label></span></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="30" maxlength="30" ng-model="fahrer.nachname" id="nachname">
	      </td>
	    </tr>
	    <tr ng-if="features.strasse">
	      <th align="right"><label for="strasse">Straße</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="30" maxlength="30" ng-model="fahrer.strasse" id="strasse">
	      </td>
	    </tr>
	    <tr ng-if="features.plz || features.wohnort">
	      <th align="right"><span ng-if="features.plz"><label for="plz">PLZ </span><span ng-if="features.wohnort">Wohnort</label></th>
	      <td>
		<span ng-if="features.plz">
		  <input ng-disabled="!enabled.fahrer" type="text" size="5" maxlength="5" ng-model="fahrer.plz" id="plz">
		</span>
		<span ng-if="features.wohnort">
		  <input ng-disabled="!enabled.fahrer" type="text" size="25" maxlength="40" ng-model="fahrer.wohnort">
		</span>
	      </td>
	    </tr>
	    <tr ng-if="features.land">
	      <th align="right"><label for="land">Staatsangehörigkeit</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="15" maxlength="15" ng-model="fahrer.land" id="land" list="land_liste">
		<datalist id="land_liste">
		  <option ng-repeat="land in vorschlaege.land" value="{{land}}">
		</datalist>
	      </td>
	    </tr>
	    <tr ng-if="features.bundesland">
	      <th align="right"><label for="bundesland">Bundesland</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="15" maxlength="20" ng-model="fahrer.bundesland" list="bundesland_liste">
		<datalist id="bundesland_liste">
		  <option ng-repeat="bundesland in vorschlaege.bundesland" value="{{bundesland}}">
		</datalist>
	      </td>
	    </tr>
	    <tr ng-if="features.telefon">
	      <th align="right"><label for="telefon">Telefon</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="20" maxlength="20" ng-model="fahrer.telefon" id="telefon">
	      </td>
	    </tr>
	    <tr ng-if="features.geburtsdatum">
	      <th align="right"><label for="geburtsdatum" accesskey="g"><span class="accesskey">G</span>eburtsdatum</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="10" maxlength="10" ng-model="fahrer.geburtsdatum" iso-date name="geburtsdatum" id="geburtsdatum">
	      </td>
	    </tr>
	    <tr ng-if="features.lizenznummer">
	      <th align="right"><label for="lizenznummer">Lizenznummer</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="20" maxlength="20" ng-model="fahrer.lizenznummer" id="lizenznummer">
	      </td>
	    </tr>
	    <tr ng-if="features.club">
	      <th align="right"><label for="club">Club</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="25" maxlength="40" ng-model="fahrer.club" id="club" list="club_liste">
		<datalist id="club_liste">
		  <option ng-repeat="club in vorschlaege.club" value="{{club}}">
		</datalist>
	      </td>
	    </tr>
	    <tr ng-if="features.bewerber">
	      <th align="right"><label for="bewerber">Bewerber</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="40" maxlength="40" ng-model="fahrer.bewerber" id="bewerber">
	      </td>
	    </tr>
	    <tr ng-if="features.fahrzeug">
	      <th align="right"><label for="fahrzeug">Fahrzeug</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="15" maxlength="30" ng-model="fahrer.fahrzeug" id="fahrzeug" list="fahrzeug_liste">
		<datalist id="fahrzeug_liste">
		  <option ng-repeat="fahrzeug in vorschlaege.fahrzeug" value="{{fahrzeug}}">
		</datalist>
	      </td>
	    </tr>
	    <tr ng-if="features.rahmennummer">
	      <th align="right"><label for="rahmennummer">Rahmennummer</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="20" maxlength="20" ng-model="fahrer.rahmennummer" id="rahmennummer">
	      </td>
	    </tr>
	    <tr ng-if="features.kennzeichen">
	      <th align="right"><label for="kennzeichen">Pol. Kennzeichen</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="15" maxlength="15" ng-model="fahrer.kennzeichen" id="kennzeichen">
	      </td>
	    </tr>
	    <tr ng-if="features.hubraum">
	      <th align="right"><label for="hubraum">Hubraum</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="10" maxlength="10" ng-model="fahrer.hubraum" id="hubraum">
	      </td>
	    </tr>
	    <tr ng-if="features.nenngeld">
	      <th align="right"><label for="nenngeld">Nenngeld</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="10" maxlength="10" ng-model="fahrer.nenngeld" id="nenngeld">
	      </td>
	    </tr>
	    <tr ng-if="features.versicherung">
	      <th align="right"><label for="versicherung">Versicherung</label></th>
	      <td>
		<select ng-disabled="!enabled.fahrer" ng-model="fahrer.versicherung" numeric id="versicherung">
		  <option value=""></option>
		  <option value="1">ADAC-Versicherung</option>
		  <option value="2">DMV-Versicherung</option>
		  <option value="3">KFZ-Versicherung</option>
		  <option value="4">Tagesversicherung</option>
		</select>
	      </td>
	    </tr>
	    <tr ng-if="features.email">
	      <th align="right"><label for="email">E-Mail</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" size="40" maxlength="60" ng-model="fahrer.email" id="email">
	      </td>
	    </tr>
	    <tr ng-if="features.bemerkung">
	      <th align="right"><label for="bemerkung">Bemerkungen</label></th>
	      <td>
		<textarea ng-disabled="!enabled.fahrer" rows="2" cols="70" maxlength="150" ng-model="fahrer.bemerkung" id="bemerkung"></textarea>
	      </td>
	    </tr>
	    <tr ng-if="features.wertungen">
	      <th align="right"><label for="wertung{{features.wertungen[0]}}">Wertungen</label></th>
	      <td>
		<span ng-repeat="wertung in features.wertungen">
		  <input ng-disabled="!enabled.fahrer" type="checkbox" ng-model="fahrer.wertungen[wertung - 1].aktiv" id="wertung{{wertung}}" accesskey="{{wertungen[wertung - 1].accesskey}}">
		    <label for="wertung{{wertung}}" ng-bind-html="wertungen[wertung - 1].label" ng-style="wertung == 1 && keine_wertung1 ? {'text-decoration': 'line-through'} : {}" title="{{wertung == 1 && keine_wertung1 ? 'Klasse ' + fahrer.klasse + ' nimmt an dieser Wertung nicht teil.': ''}}"></label>
		</span>
	      </td>
	    </tr>
	    <tr>
	      <th align="right">Teilnahme</th>
	      <td>
		<span ng-if="features.nennungseingang">
		  <input ng-disabled="!enabled.fahrer" type="checkbox" ng-model="fahrer.nennungseingang" id="nennungseingang">
		    <label for="nennungseingang" accesskey="e">Nennungs<span class="accesskey">e</span>ingang</label>
		</span>
		<input ng-disabled="!enabled.fahrer" type="checkbox" ng-model="fahrer.start" id="start">
		  <label for="start" accesskey="s" ng-style="!kann_starten() ? {'text-decoration': 'line-through'} : {}" title="{{!kann_starten() ? (fahrer.klasse == null ? (gruppen ? 'Gruppe' : 'Fahrer') + ' ist keiner Klasse zugewiesen.' : 'Klasse ' + fahrer.klasse + ' startet nicht.') : ''}}"><span class="accesskey">S</span>tart</label>
		<span ng-if="features.start_morgen">
		  <input ng-disabled="!enabled.fahrer" type="checkbox" ng-model="fahrer.start_morgen" id="start_morgen">
		    <label for="start_morgen" accesskey="m">Start <span class="accesskey">m</span>orgen</label>
		</span>
		<input ng-disabled="!enabled.fahrer" type="checkbox" ng-model="fahrer.ausser_konkurrenz" id="ausser_konkurrenz">
		  <label for="ausser_konkurrenz" accesskey="a" ng-style="ausser_konkurrenz ? {'text-decoration': 'line-through'} : {}" title="{{ausser_konkurrenz ? 'Klasse ' + fahrer.klasse + ' startet außer Konkurrenz.' : ''}}"><span class="accesskey">A</span>ußer Konkurrenz</label>
	      </td>
	    </tr>
	    <tr ng-if="features.helfer">
	      <th align="right"><label for="helfer">Helfer</label></th>
	      <td>
		<input ng-disabled="!enabled.fahrer" type="text" numeric size="3" maxlength="5" min="1" max="99999" ng-model="fahrer.helfer" id="helfer">
	      </td>
	    </tr>
	  </table>
	</fieldset><br>
	<fieldset style="display:inline" ng-if="gruppen && fahrer">
	  <legend>Fahrer in Gruppe</legend>
	  <span ng-repeat="startnummer in fahrer.fahrer">
	    <a href="" ng-click="fahrer_entfernen(startnummer)" ng-style="mitglied_startet(startnummer) ? {} : {'text-decoration': 'line-through'}" title="Aus Gruppe entfernen{{mitglied_startet(startnummer) ? '' : ' (Fahrer startet nicht)'}}">{{mitglied_name(startnummer)}}</a><br>
	  </span>
	</fieldset>
      </form>
    </td>
    <td valign="top">
      <form name="navigation">
	<fieldset>
	  <legend>Navigation</legend>
	  <p>
	    <button type="button" ng-disabled="geaendert()" ng-click="fahrer_laden(null, 'naechster')" tabindex="-1">|&lt;</button>
	    <button type="button" ng-disabled="geaendert()" ng-click="fahrer_laden(fahrer.startnummer, 'vorheriger')" tabindex="-1">&lt;</button>
	    <button type="button" ng-disabled="geaendert()" ng-click="fahrer_laden(fahrer.startnummer, 'naechster')" tabindex="-1">&gt;</button>
	    <button type="button" ng-disabled="geaendert()" ng-click="fahrer_laden(null, 'vorheriger')" tabindex="-1">&gt;|</button>
	  </p>
	  <p>
	    <label for="suchbegriff" accesskey="f" ng-if="!gruppen"><span class="accesskey">F</span>ahrer suchen:</label>
	    <label for="suchbegriff" accesskey="g" ng-if="gruppen"><span class="accesskey">G</span>ruppe suchen:</label><br>
	    <input type="text" ng-disabled="geaendert()" size="20" maxlength="40" ng-model="suche.begriff" onchange="angular.element(this).scope().fahrer_suchen()" id="suchbegriff" tabindex="-1" autofocus autocomplete="off" autocorrect="off" autocapitalize="off"><br>
	  </p>
	  <p>
	    <span ng-repeat="fahrer in fahrerliste">
	      <a href="" ng-click="fahrer_laden(fahrer.startnummer)" title="{{fahrer_infos(fahrer, this)}}">{{fahrer_name(fahrer)}}</a><br>
	    </span>
	    <span ng-if="fahrerliste != null && fahrerliste.length == 0">Keine {{gruppen ? 'Gruppen' : 'Fahrer'}} gefunden.</span>
	  </p>
	  <p ng-if="gruppen && fahrer">
	    <label for="mitglied_suchbegriff">Fahrer suchen:</label><br>
	    <input type="text" ng-disabled="!fahrer" size="20" maxlength="40" ng-model="mitglied_suche.begriff" onchange="angular.element(this).scope().mitglied_suchen()" id="mitglied_suchbegriff" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off">
	  </p>
	  <p>
	    <span ng-repeat="startnummer in mitglied_liste">
	      <a href="" ng-click="fahrer_hinzufuegen(startnummer)" ng-style="mitglied_startet(startnummer) ? {} : {'text-decoration': 'line-through'}" title="Zu Gruppe hinzufügen{{mitglied_startet(startnummer) ? '' : ' (Fahrer startet nicht)'}}">{{mitglied_name(startnummer)}}</a><br>
	    </span>
	  </p>
	  <p>
	    <span style="color:red" ng-if="fehler">{{fehler}}<br></span>
	    <!-- if (!(fahrer && fahrer.start && startende_klassen[fahrer.klasse - 1])) ... -->
	    <span ng-if="startnummer_belegt.startnummer">
	      <span ng-if="startnummer_belegt.id" style="color:green">
		Vorsicht, Startnummer war bereits in Verwendung:<br>
		{{startnummer_belegt.titel}}<br>
		{{startnummer_belegt.nachname}} {{startnummer_belegt.vorname}}<br>
		<!-- Nächste freie Startnummer: {{startnummer_belegt.naechste_startnummer}}<br> -->
	      </span>
	      <span ng-if="!startnummer_belegt.id" style="color:red">
		Startnummer belegt:<br>
		{{startnummer_belegt.nachname}} {{startnummer_belegt.vorname}}<br>
		Nächste freie Startnummer: {{startnummer_belegt.naechste_startnummer}}<br>
	      </span>
	    </span>
	    <span ng-if="!startnummer_belegt.startnummer && startnummer_belegt.naechste_startnummer">
	      Nächste freie Startnummer in Klasse: {{startnummer_belegt.naechste_startnummer}}<br>
	    </span>
	    <span ng-if="fahrer.start && !kann_starten()" style="color:red">
	      <span ng-if="fahrer.klasse != null">
		Für Klasse {{fahrer.klasse}} sind keine zu befahrenen Runden und Sektionen<br>
		ausgewählt, die Klasse startet daher nicht.
	      </span>
	      <span ng-if="fahrer.klasse == null">
		Fahrer ist keiner Klasse zugewiesen,<br>
		und kann daher nicht gewertet werden.
	      </span>
	    </span>
	    <span ng-if="veranstaltung.art.match('^otsv') && ist_oesterreich(fahrer.land)" style="color:red">
	      Bitte das Feld Staatsangehörigkeit für Österreicher leer lassen.
	    </span>
	    <span ng-if="veranstaltung.art == 'otsv2014' || veranstaltung.art == 'otsv+osk2014' || veranstaltung.art == 'otsv2016' || veranstaltung.art == 'otsv+osk2016'" style="color:red">
	      <span ng-if="!fahrer.ausser_konkurrenz">
		<span ng-if="fahrer.geburtsdatum">
		  <span ng-if="(fahrer.klasse == 3 || fahrer.klasse == 5) && jahrgang_alter >= 45">
		    Fahrer ist vor Jahrgang {{jahrgang(44)}} geboren<br>und muss stattdessen in Klasse {{fahrer.klasse + 1}} starten.
		  </span>
		  <span ng-if="(fahrer.klasse == 4 || fahrer.klasse == 6) && jahrgang_alter < 45">
		    Fahrer ist nach Jahrgang {{jahrgang(45)}} geboren<br>und muss stattdessen in Klasse {{fahrer.klasse - 1}} starten.
		  </span>
		  <span ng-if="fahrer.klasse == 11 && alter < 14">
		    Fahrer ist unter 14 Jahre alt<br>und darf in Klasse 11 noch nicht starten.
		  </span>
		  <span ng-if="fahrer.klasse == 12">
		    <span ng-if="alter < 12">
		      Fahrer ist unter 12 Jahre alt<br>und darf in Klasse 12 noch nicht starten.
		    </span>
		    <span ng-if="jahrgang_alter >= 18">
		      Fahrer ist vor Jahrgang {{jahrgang(17)}} geboren<br>und darf in Klasse 12 nicht mehr starten.
		    </span>
		  </span>
		  <span ng-if="fahrer.klasse == 13">
		    <span ng-if="alter < 10">
		      Fahrer ist unter 10 Jahre alt<br>und darf in Klasse 13 noch nicht starten.
		    </span>
		    <span ng-if="jahrgang_alter >= 16">
		      Fahrer ist vor Jahrgang {{jahrgang(15)}} geboren<br>und darf in Klasse 13 nicht mehr starten.
		    </span>
		  </span>
		</span>
		<span ng-if="fahrer.klasse >= 11 && fahrer.klasse <= 13">
		  <span ng-if="!fahrer.lizenznummer">
		    Bitte die Lizenznummer eintragen.
		  </span>
		  <span ng-if="fahrer.lizenznummer && !osk_lizenz(fahrer) && fahrer_in_wertung1(fahrer)">
		    Fahrer hat keine OSK-Lizenznummer (IJM / JM / JMJ)<br>und darf an der Jahreswertung nicht teilnehmen.
		  </span>
		</span>
	      </span>
	    </span>
	    <span ng-if="veranstaltung.art == 'otsv-ecup2015'" style="color:red">
	      <span ng-if="!fahrer.ausser_konkurrenz">
		<span ng-if="fahrer.geburtsdatum">
		  <span ng-if="fahrer.klasse == 1 && jahrgang_alter > 6">
		    Fahrer ist vor Jahrgang {{jahrgang(6)}} geboren<br>und muss in einer höheren Klasse starten.
		  </span>
		  <span ng-if="(fahrer.klasse == 2 || fahrer.klasse == 3) && jahrgang_alter < 7" style="color:green">
		    Fahrer ist nach Jahrgang {{jahrgang(7)}} geboren<br>und darf auch in einer niedrigeren Klasse starten.
		  </span>
		  <span ng-if="(fahrer.klasse == 2 || fahrer.klasse == 3) && jahrgang_alter > 8">
		    Fahrer ist vor Jahrgang {{jahrgang(8)}} geboren<br>und muss in einer höheren Klasse starten.
		  </span>
		  <span ng-if="(fahrer.klasse == 4 || fahrer.klasse == 5) && jahrgang_alter < 9" style="color:green">
		    Fahrer ist nach Jahrgang {{jahrgang(9)}} geboren<br>und darf auch in einer niedrigeren Klasse starten.
		  </span>
		</span>
	      </span>
	    </span>
	  </p>
	  <p>
	    <button type="button" ng-disabled="!(geaendert() && form.$valid) || busy" ng-click="speichern()" tabindex="-1">Speichern</button>
	    <button type="button" ng-disabled="!(geaendert() || enabled.verwerfen) || busy" ng-click="verwerfen()" tabindex="-1">Verwerfen</button>
	  </p>
	  <p>
	    <button type="button" ng-disabled="geaendert() || !enabled.neu" ng-click="neuer_fahrer()" accesskey="u" tabindex="-1">
	      <span ng-if="!gruppen">Ne<span class="accesskey">u</span>er Fahrer</span>
	      <span ng-if="gruppen">Ne<span class="accesskey">u</span>e Gruppe</button></span><br>
	    <span ng-if="features.startnummer">
	      <button type="button" ng-disabled="!enabled.fahrer || enabled.startnummer" ng-click="startnummer_aendern()" accesskey="ä" tabindex="-1">Startnummer <span class="accesskey">ä</span>ndern</button><br>
	    </span>
	    <button type="button" ng-disabled="geaendert() || !enabled.loeschen" ng-disabled="!enabled.fahrer" ng-click="loeschen()" accesskey="l" tabindex="-1">
	      {{gruppen ? 'Gruppe' : 'Fahrer'}} <span class="accesskey">l</span>öschen</button>
	  </p>
	</fieldset>
      </form>
    </td>
  </tr>
</table>
